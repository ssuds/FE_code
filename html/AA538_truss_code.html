
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Truss FE code for 2D structures</title><meta name="generator" content="MATLAB 9.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2017-11-12"><meta name="DC.source" content="AA538_truss_code.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Truss FE code for 2D structures</h1><!--introduction--><p>AA 538 Introduction to Structural Optimization Shreyas Sudhakar</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Clearing all previous data in workspace</a></li><li><a href="#2">Define filename of input deck</a></li><li><a href="#3">Contents of input deck</a></li><li><a href="#4">Read in input deck and store its values</a></li><li><a href="#5">Defines the degrees of freedom and associates each dof with a node and a direction</a></li><li><a href="#6">Compute the C vectors for each element</a></li><li><a href="#7">Compute the transformation matrix for each element</a></li><li><a href="#8">Create global stiffness matrix</a></li><li><a href="#9">Create global mass matrix</a></li><li><a href="#10">Create stiffness and mass matrices for each set of boundary conditions</a></li><li><a href="#11">Create the force input vectors for each static load case</a></li><li><a href="#12">Solve the static problem [K]{u}={F}</a></li><li><a href="#13">Compute and display the static solution (Stresses in each element)</a></li><li><a href="#14">Generate mass matrix for the unconstrained problem for each mass case</a></li><li><a href="#15">Solve the Dynamic Cases to find Natural Frequencies, Eigenvectors, and Eigenvalues</a></li><li><a href="#16">Create buckling constraints for truss members</a></li><li><a href="#17">Compute analytic sensitivities</a></li></ul></div><h2 id="1">Clearing all previous data in workspace</h2><pre class="codeinput">clear;
</pre><h2 id="2">Define filename of input deck</h2><pre class="codeinput">file_name = <span class="string">'input.txt'</span>;
</pre><h2 id="3">Contents of input deck</h2><pre class="codeinput">type (file_name);
</pre><pre class="codeoutput">
#Number of nodes
6
#Coordinates of nodes
#id	x	y
1 720 360
2 720 0
3 360 360
4 360 0
5 0 360
6 0 0
#Number of materials
2
#Material Properties
#id	E	sigma_yt	sigma_yc	rho
1 10000000 25000 25000 0.1
2 10000000 75000 75000 0.1
#Number of elements
10
#element properties
#element_id	id_node1	id_node2	id_material	A
1 5 3 1 7.90
2 3 1 1 0.10
3 6 4 1 8.10
4 4 2 1 3.90
5 3 4 1 0.10
6 1 2 1 0.10
7 5 4 1 5.80
8 6 3 1 5.51
9 3 2 2 3.68
10 4 1 1 0.14
#Number of concentrated non structural masses
3
#concentrated mass properties
#id	mass	node
1 0.125 1
2 0.043 3
3 0.016 5
#Number of static force cases
2
#force case properties
#id	forces(zeros for unloaded dofs or non zero for forces in that direction and node)
1 0 0 0 -100000 0 0 0 -100000 0 0 0 0
1 0 0 0 -200000 0 0 0 -200000 0 0 0 0
#Number of Boundary condition sets
1
#boundary condition set properties
#id	boundary_condition(free 1 or constrained 0)
1 1 1 1 1 1 1 1 1 0 0 0 0
#Number of static load cases
2
#static load case properties
#id	forcevector_index	boundary_condition_case		
1 1 1
2 2 1
#Number of natural vibrations cases
2
#dynamic load case properties
#id	boundary_condition_case	mass_case	number_lowest_frequencies
1 1 1 2
2 1 1 3
#Number of non-structural mass cases
2
#Mass case properties
#id	conc_mass_ids	
1 1 2 3
2 2 3
#Should analytic sensitivities be computed (1 if yes, 0 if no)
1
</pre><h2 id="4">Read in input deck and store its values</h2><pre class="codeinput">[Nnodes,n_dof,nodes,Nmaterials,materials,Nelements,elements,NconcM,concmasses,Nforcecases,forcecases,NBCsets,BCdofID,Nstatic,static_load,Nmasscases,masscases,Ndynamic,dynamic_cases,sensitivityflag] = inputs(file_name);
</pre><h2 id="5">Defines the degrees of freedom and associates each dof with a node and a direction</h2><pre class="codeinput">dof_index = dofproperties(n_dof);
</pre><h2 id="6">Compute the C vectors for each element</h2><pre class="codeinput">c = cvector(n_dof,Nelements,elements,nodes,dof_index,materials);
</pre><h2 id="7">Compute the transformation matrix for each element</h2><pre class="codeinput">T = transformationmatrix(n_dof,Nelements,elements,nodes,dof_index,materials);
</pre><h2 id="8">Create global stiffness matrix</h2><pre class="codeinput">[Kglobal,Kellocal_elements] = stiffnessmatrix(n_dof,Nelements,elements,nodes,dof_index,materials,T);
</pre><h2 id="9">Create global mass matrix</h2><pre class="codeinput">[Mglobal,Melglobal_elements] = massmatrix(n_dof,Nelements,elements,nodes,dof_index,materials);
</pre><h2 id="10">Create stiffness and mass matrices for each set of boundary conditions</h2><pre class="codeinput">[Kglobal_bcs,Mglobal_bcs] = KandMwithBCs(NBCsets,Kglobal,Mglobal,BCdofID,n_dof);
</pre><h2 id="11">Create the force input vectors for each static load case</h2><pre class="codeinput">force_inputs = forceinputs(n_dof,Nstatic,static_load,forcecases,BCdofID);
</pre><h2 id="12">Solve the static problem [K]{u}={F}</h2><pre class="codeinput">u = solvedisplacement(n_dof,Nstatic,static_load,force_inputs,Kglobal_bcs);
</pre><pre class="codeoutput">lsqr converged at iteration 10 to a solution with relative residual 5.4e-07.
lsqr converged at iteration 10 to a solution with relative residual 5.4e-07.
</pre><h2 id="13">Compute and display the static solution (Stresses in each element)</h2><pre class="codeinput">stress_matrix = solvestress(Nelements,Nstatic,n_dof,c,forcecases,BCdofID,elements,nodes,dof_index,materials,u);

disp(<span class="string">'The stresses in each element in PSI are displayed below in order of element number (vertically) and load case (horizontally)'</span>);
disp(stress_matrix);
</pre><pre class="codeoutput">The stresses in each element in PSI are displayed below in order of element number (vertically) and load case (horizontally)
   1.0e+04 *

    2.5001    5.0001
    2.4879    4.9758
   -2.4999   -4.9999
   -2.5003   -5.0006
   -0.0071   -0.0141
    2.4879    4.9758
    2.4991    4.9983
   -2.5026   -5.0052
    3.7474    7.4947
   -2.5132   -5.0263

</pre><h2 id="14">Generate mass matrix for the unconstrained problem for each mass case</h2><pre class="codeinput">Mglobal_masscases = MwithCases(Nmasscases,Mglobal,masscases,concmasses,dof_index);
</pre><h2 id="15">Solve the Dynamic Cases to find Natural Frequencies, Eigenvectors, and Eigenvalues</h2><pre class="codeinput">[natural_freqs, phi, lambda] = solvedynamic(Ndynamic,dynamic_cases,Kglobal_bcs,Mglobal_masscases,n_dof);
</pre><h2 id="16">Create buckling constraints for truss members</h2><pre class="codeinput">g_buckling = buckling(n_dof,Nelements,elements,nodes,dof_index,materials,Nstatic,stress_matrix);
</pre><h2 id="17">Compute analytic sensitivities</h2><pre class="codeinput"><span class="keyword">if</span> sensitivityflag == 1 <span class="comment">%Analytic sensitivities for will only be computed if the sensitivity flag is 1 within the input deck</span>
    [dK_dA,dsigma_dA,dF_dA,dM_dA,dlambda_dA,dgbuckling_dAj] = sensitivities(n_dof,Nelements,elements,nodes,dof_index,materials,Kellocal_elements,T,Nstatic,u,static_load,Kglobal_bcs,c,Melglobal_elements,Ndynamic,phi,stress_matrix);
<span class="keyword">end</span>
</pre><pre class="codeoutput">
u_case =

    3.5913
  -14.4089
   -3.6002
  -16.2002
    1.8000
   -5.4038
   -1.8000
   -5.3987
         0
         0
         0
         0

lsqr converged at iteration 12 to a solution with relative residual 1.9e-08.
lsqr converged at iteration 10 to a solution with relative residual 7.6e-08.
lsqr converged at iteration 12 to a solution with relative residual 7.3e-08.
lsqr converged at iteration 10 to a solution with relative residual 6.1e-07.
lsqr converged at iteration 9 to a solution with relative residual 3.5e-07.
lsqr converged at iteration 10 to a solution with relative residual 6e-07.
lsqr stopped at iteration 12 without converging to the desired tolerance 1e-06
because the maximum number of iterations was reached.
The iterate returned (number 12) has relative residual 0.00054.
lsqr stopped at iteration 12 without converging to the desired tolerance 1e-06
because the maximum number of iterations was reached.
The iterate returned (number 12) has relative residual 0.00083.
lsqr converged at iteration 11 to a solution with relative residual 5.2e-11.
lsqr converged at iteration 10 to a solution with relative residual 3.6e-08.

u_case =

    3.5913
  -14.4089
   -3.6002
  -16.2002
    1.8000
   -5.4038
   -1.8000
   -5.3987
         0
         0
         0
         0

lsqr converged at iteration 12 to a solution with relative residual 1.9e-08.
lsqr converged at iteration 10 to a solution with relative residual 7.6e-08.
lsqr converged at iteration 12 to a solution with relative residual 7.3e-08.
lsqr converged at iteration 10 to a solution with relative residual 6.1e-07.
lsqr converged at iteration 9 to a solution with relative residual 3.5e-07.
lsqr converged at iteration 10 to a solution with relative residual 6e-07.
lsqr stopped at iteration 12 without converging to the desired tolerance 1e-06
because the maximum number of iterations was reached.
The iterate returned (number 12) has relative residual 0.00054.
lsqr stopped at iteration 12 without converging to the desired tolerance 1e-06
because the maximum number of iterations was reached.
The iterate returned (number 12) has relative residual 0.00083.
lsqr converged at iteration 11 to a solution with relative residual 5.2e-11.
lsqr converged at iteration 10 to a solution with relative residual 3.6e-08.
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2017a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Truss FE code for 2D structures
% AA 538 Introduction to Structural Optimization
% Shreyas Sudhakar

%% Clearing all previous data in workspace
clear; 

%% Define filename of input deck
file_name = 'input.txt';

%% Contents of input deck
type (file_name);

%% Read in input deck and store its values
[Nnodes,n_dof,nodes,Nmaterials,materials,Nelements,elements,NconcM,concmasses,Nforcecases,forcecases,NBCsets,BCdofID,Nstatic,static_load,Nmasscases,masscases,Ndynamic,dynamic_cases,sensitivityflag] = inputs(file_name);
 
%% Defines the degrees of freedom and associates each dof with a node and a direction
dof_index = dofproperties(n_dof);

%% Compute the C vectors for each element
c = cvector(n_dof,Nelements,elements,nodes,dof_index,materials);

%% Compute the transformation matrix for each element
T = transformationmatrix(n_dof,Nelements,elements,nodes,dof_index,materials);

%% Create global stiffness matrix
[Kglobal,Kellocal_elements] = stiffnessmatrix(n_dof,Nelements,elements,nodes,dof_index,materials,T);

%% Create global mass matrix
[Mglobal,Melglobal_elements] = massmatrix(n_dof,Nelements,elements,nodes,dof_index,materials);

%% Create stiffness and mass matrices for each set of boundary conditions
[Kglobal_bcs,Mglobal_bcs] = KandMwithBCs(NBCsets,Kglobal,Mglobal,BCdofID,n_dof);

%% Create the force input vectors for each static load case
force_inputs = forceinputs(n_dof,Nstatic,static_load,forcecases,BCdofID);

%% Solve the static problem [K]{u}={F}
u = solvedisplacement(n_dof,Nstatic,static_load,force_inputs,Kglobal_bcs);

%% Compute and display the static solution (Stresses in each element)
stress_matrix = solvestress(Nelements,Nstatic,n_dof,c,forcecases,BCdofID,elements,nodes,dof_index,materials,u);

disp('The stresses in each element in PSI are displayed below in order of element number (vertically) and load case (horizontally)');
disp(stress_matrix);

%% Generate mass matrix for the unconstrained problem for each mass case 
Mglobal_masscases = MwithCases(Nmasscases,Mglobal,masscases,concmasses,dof_index);

%% Solve the Dynamic Cases to find Natural Frequencies, Eigenvectors, and Eigenvalues
[natural_freqs, phi, lambda] = solvedynamic(Ndynamic,dynamic_cases,Kglobal_bcs,Mglobal_masscases,n_dof);

%% Create buckling constraints for truss members
g_buckling = buckling(n_dof,Nelements,elements,nodes,dof_index,materials,Nstatic,stress_matrix);

%% Compute analytic sensitivities
if sensitivityflag == 1 %Analytic sensitivities for will only be computed if the sensitivity flag is 1 within the input deck
    [dK_dA,dsigma_dA,dF_dA,dM_dA,dlambda_dA,dgbuckling_dAj] = sensitivities(n_dof,Nelements,elements,nodes,dof_index,materials,Kellocal_elements,T,Nstatic,u,static_load,Kglobal_bcs,c,Melglobal_elements,Ndynamic,phi,stress_matrix);
end
##### SOURCE END #####
--></body></html>